!function(){var e="https://www.quzhuanpan.com",a="",t=9e5,s="",n=new Worker("js/resource/resource_background.js"),r=!1;chrome.runtime.onInstalled.addListener(function(a){a&&a.reason&&"install"==a.reason&&(chrome.tabs.create({url:"dashboard.html"}),$.ajax({url:e+"/browser/statistics/install_num",async:!0,type:"POST",dataType:"json",success:function(e){},error:function(e){}}))}),chrome.browserAction.onClicked.addListener(function(e){chrome.tabs.create({url:"dashboard.html"})});var o=[{name:"综合",value:100,status:1},{name:"自然",value:1,status:0},{name:"名画",value:2,status:0},{name:"动漫",value:3,status:0},{name:"创意",value:4,status:0}],c=[],i=[],l=[{name:"百度",url:"https://www.baidu.com/s?wd=@"},{name:"资源",url:"https://www.quzhuanpan.com/source/search.action?q=@&currentPage=1"},{name:"文库",url:"https://www.wocali.com/s/search.action?q=@&currentPage=1"},{name:"知乎",url:"https://www.zhihu.com/search?type=content&q=@"},{name:"微博",url:"https://s.weibo.com/weibo/@"}],u={comprehensive_pic_url:"img/default.jpg",natural_pic_url:"img/default.jpg",painting_pic_url:"img/default.jpg",anime_pic_url:"img/default.jpg",originality_pic_url:"img/default.jpg"},g={};$.ajax({url:e+"/browser/statistics/open_num",async:!0,type:"POST",dataType:"json",success:function(e){},error:function(e){}}),setInterval(function(){chrome.storage.local.get(["saveMarkTime"],function(e){var a=!1,s=(new Date).getTime();if(e.saveMarkTime){var n=e.saveMarkTime;s-Number(n)>t?(a=!0,chrome.storage.local.set({saveMarkTime:s+""},function(){})):a=!1}else chrome.storage.local.set({saveMarkTime:s+""},function(){}),b.saveAll(),a=!0;a?m.getAll():b.getAll(!0)})},500);var m={getServerData:function(){$.ajax({url:e+"/browser/v2_data",async:!1,timeout:1e3,success:function(e){if(e){var t=e.backgroundImage;u.comprehensive_pic_url=t.comprehensive_pic_url,u.natural_pic_url=t.natural_pic_url,u.painting_pic_url=t.painting_pic_url,u.anime_pic_url=t.anime_pic_url,u.originality_pic_url=t.originality_pic_url;var n=e.supplement;s=n.showMessage;var r=e.searchWebsites;l=r;var o=e.serverWebsites;c=o,a=e.lastVersion}},error:function(){chrome.storage.local.set({saveMarkTime:""},function(){})}})},getAll:function(){m.getServerData(),b.getSettingObj(),b.saveAll(),r=!0}},b={loadLocalBackgroundTypesObj:function(){chrome.storage.local.get(["backgroundTypes"],function(e){e.backgroundTypes?o=e.backgroundTypes:b.saveBackgroundTypesObj(o),console.log(o)})},saveShowMessage:function(e){chrome.storage.local.set({showMessage:e},function(){})},saveBackgroundTypesObj:function(e){chrome.storage.local.set({backgroundTypes:e},function(){})},saveBackgroundImagesObj:function(e){chrome.storage.local.set({backgroundImages:e},function(){})},saveSearchSelectWebsiteObj:function(e){chrome.storage.local.set({searchSelectWebsiteObj:e},function(){})},saveServerWebsiteObj:function(e){chrome.storage.local.set({serverWebsiteObj:e},function(){})},saveSettingObj:function(e){chrome.storage.local.set({settingObj:e},function(){})},saveLastVersionObj:function(e){chrome.storage.local.set({lastVersion:e},function(){})},saveAll:function(){b.saveBackgroundTypesObj(o),b.saveBackgroundImagesObj(u),b.saveSearchSelectWebsiteObj(l),b.saveServerWebsiteObj(c),b.saveSettingObj(g),b.saveShowMessage(s),b.saveLastVersionObj(a)},getSettingObj:function(){chrome.storage.local.get(["settingObj"],function(e){e.settingObj&&(g=e.settingObj)})},getAll:function(e){chrome.storage.local.get(["backgroundTypes","backgroundImages","settingObj","serverWebsiteObj","searchSelectWebsiteObj","showMessage","lastVersion"],function(a){var t=a.backgroundTypes,n=a.backgroundImages,r=a.settingObj,i=a.serverWebsiteObj,b=a.searchSelectWebsiteObj,p=a.showMessage;a.lastVersion;t&&n&&r&&i&&b?(o=t,c=i,l=b,u=n,g=r,s=p):e&&m.getAll()}),r=!0}};chrome.contextMenus.create({type:"normal",title:"使用去转盘搜索“%s”",id:"search-quzhuanpan",contexts:["selection"],onclick:function(e,a){var t=e.selectionText;t?window.open("https://www.quzhuanpan.com/source/search.action?q="+encodeURIComponent(t),"_blank"):window.open("https://www.quzhuanpan.com","_blank")}});var p={initUrl:"",code:"",time:0,fileName:"",url:"",scripts:"",serverUrl:e};let h=!0;chrome.runtime.onMessage.addListener(function(e,t,m){if("newTabs"==e.origin)m({backgroundTypes:o,serverWebsiteObj:c,saveWebsitesObj:i,searchSelectWebsiteObj:l,backgroundImages:u,settingObj:g,defaultBackgroundImage:"img/default.jpg",showMessage:s,pluginIsEnd:r,lastVersion:a});else if("newTabs-setting"==e.origin){var d=e.backgroundTypes;o=d,b.saveBackgroundTypesObj(o),m("")}else"pickup-code-url"==e.origin?(p.initUrl=e.initUrl,p.code=e.code,p.time=e.time):"resouorce-url"==e.origin&&(p.fileName=e.fileName,p.url=e.url,p.scripts=e.scripts,h?(n.postMessage({operation:"run-source-page-crawler",resourceData:p}),h=!1):console.log("This request has not been completed yet."),v.clear())});var v={clear:function(){p.initUrl="",p.code="",p.time=0,p.fileName="",p.url="",p.scripts=""}};n.addEventListener("message",function(e){var a=e.data,t=a.operation;"notification"==t?console.log(a):"resourcePageCrawlerResult"==t&&(h=!0,console.log(a.status))},!1)}();